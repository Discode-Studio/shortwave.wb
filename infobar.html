<!DOCTYPE html>
<html>
    <head>
        <title>SW_RadioListener Infobar</title>
        <style>
            body, html {
                margin: 0;
                padding: 0;
            }

            #main {
                font-family: 'Cantarell';
            }

            #MSKTime, #dateMSK, #clockUTC, #desc1, #desc2, #desc3, #desc4, #otherText, #shortwaveStuff, #dateUTC, #socialText, #socialImg, #faq, #timer, #clockMSK, #UTCTime, #MSKTime, #fa2q {
                z-index: 100;
                position: absolute;
                color: white;
                font-size: 42px;
                font-weight: bold;
            }

            #clockUTC { left: 230px; top: 80px; }
            #dateUTC { left: 230px; top: 40px; }
            #UTCTime { left: 20px; top: 10px; font-size: 75px; }

            #clockMSK { left: 230px; top: 210px; }
            #dateMSK { left: 230px; top: 170px; }
            #MSKTime { left: 20px; top: 150px; font-size: 75px; }

            #desc1 { left: 20px; top: 300px; font-size: 45px; }
            #desc2 { left: 20px; top: 360px; font-size: 45px; }
            #desc3 { left: 20px; top: 415px; font-size: 45px; }
            #desc4 { left: 20px; top: 470px; font-size: 45px; }

            #otherText { left: 50px; top: 830px; font-size: 50px; }
            #timer { left: 20px; top: 650px; font-size: 30px; }

            #socialImg { left: 30px; top: 975px; font-size: 50px; }
            #socialText { left: 30px; top: 935px; font-size: 50px; }

            #faq { left: 10px; top: 1035px; font-size: 20.5px; }

            @keyframes fade {
                0%   { opacity: 1; }
                100% { opacity: 0; }
            }
            #socialText, #socialImg {
                animation-name: fade;
                animation-duration: 0.5s;
                animation-timing-function: cubic-bezier(1,0,0,1);
            }
            #socialText, #socialImg { animation-direction: reverse;  }
            
            #muf {
              color: white;
            }
            
            p#fa2q {
              left: 20px;
              top: 590px;
              font-size: 30px;
              text-decoration: underline
            }
            h1#fa2q {
              left: 20px;
              top: 520px;
              font-size: 50px
            }
        </style>

        <div id="main">  
            <img src="thing.png">
            <h1 id="clockUTC">--:--:-- UTC</h1>
            <h1 id="clockMSK">--:--:-- MSK</h1>
            <h1 id="UTCTime">UTC</h1>
            <h1 id="MSKTime">MSK</h1>
            <h1 id="dateMSK"></h1>
            <h1 id="desc1"></h1>
            <h1 id="desc2"></h1>
            <h1 id="desc3" id="station"></h1>
            <h1 id="desc4"></h1>
            <h1 id="fa2q">> Fast FAQ</h1>
            <p id="fa2q">- You have to know:<br>
            The stream is reloading every 30 seconds <br>to avoid the time limit<br>
            - Why is the stream black?<br>
            If the stream (SDR) is black,<br>
            it's because it's maybe full or unavailable.</p>
            <h1 id="otherText"> </h1>
            <h1 id="dateUTC"></h1>
            <h1 id="timer"></h1>
            <h1 id="thanks"></h1>
            <h1 id="socialText" style="color: #FE0000;">Loading infobar...</h1>
            <h1 id="faq">Infobar by @ShortwaveStuff, inspired by The SWL Channel</h1>
        </div>

        <div class="devmenu" hidden>
            <input id="textInput" value="Station Name,n">
            <button onclick="setText(document.getElementById('textInput').value, 0)">Set Properties to Text 1</button>
            <button onclick="setText(document.getElementById('textInput').value, 1)">Set Properties to Text 2</button>
            <button onclick="setTimerToText()">Trigger Timer</button>
            <input id="presetNumber" value="0">
            <button onclick="usePreset(document.getElementById('presetNumber').value)">Use Preset</button>
        </div>
        
       <script>
            const presets = [
                "The Goose,n|4310/3243 kHz,50px,120px,810px",
                "The Pip,n|5448/3756 kHz,50px,120px,810px",
                "The Sq. Whl.,n|5367/3363.5 kHz,48px,110px,830px",
                "UVB-76,4625 kHz,48px,110px"
            ];
            const socialsList = [
                
                "yt,R1 Blackout coming...",
                "yt,R2 Blackout Occured...",
                "yt,Join my discord server",
                "yt,Discord server in chat,#FE0000",
                "yt,Website: Signabroam",
                "yt,@MirossOffYT Official,#FE0000",
                "yt,UVB-76 Livestream,#FE0000",
                "yt,FAQ in description"
                "yt,UVB-76 Livestream üî¥"
            ];
            var currentSocial = 6;
            const donators = ["NaN"];
            var currentDonator = 0;

            function usePreset(presetNumber) {
                const splitting = presets[presetNumber].split('|');
                setText(splitting[0], 0);
                setText(splitting[1], 1);
            }

            function setText(text, textNum) {
                const elements = ["station", "otherText"];
                const properties = text.split(',');
                document.getElementById(elements[textNum]).innerHTML = properties[0];
                if (properties[1] != "n" && properties[1] != "no")
                {
                    document.getElementById(elements[textNum]).style.fontSize = properties[1];
                    document.getElementById(elements[textNum]).style.left = properties[2];
                    document.getElementById(elements[textNum]).style.top = properties[3];
                }
            }

            // Thanks to ch4
            function updateClocks() {
                const Weekdays = ["Sun.", "Mon.", "Tue.", "Wed.", "Thu.", "Fri.", "Sat."];
                const dateUTC = new Date();
                const dateMSK = new Date(dateUTC.getTime() + 3 * 60 * 60 * 1000);

                document.getElementById("clockUTC").innerHTML = dateUTC.toISOString().slice(11, 19);
                document.getElementById("dateUTC").innerHTML = `${Weekdays[dateUTC.getUTCDay()]} ${dateUTC.toISOString().slice(0, 10)}`;

                document.getElementById("clockMSK").innerHTML = dateMSK.toISOString().slice(11, 19);
                document.getElementById("dateMSK").innerHTML = `${Weekdays[dateMSK.getUTCDay()]} ${dateMSK.toISOString().slice(0, 10)}`;
            }

            function setTimerToText(howManyMins) {
                var timeLeftSecs = 5 * 60; // 10 minutes

                setInterval(() => {
                    timeLeftSecs -= 0.1;
                    document.getElementById("otherText").innerHTML = "Left: " + Math.floor(timeLeftSecs);
                }, 100);
            }

            function updateSocials() {
                currentSocial++;
                if (currentSocial >= socialsList.length) currentSocial = 0;

                const newValues = socialsList[currentSocial].split(',');
                var funnyElement = document.getElementById("socialText");
                var funnyImageAA = document.getElementById("socialImg" );

                funnyElement.innerText = newValues[1];
                funnyElement.style.color = newValues[2];
                funnyImageAA.src = newValues[0] + ".png";
            }
            function updateDonators() {
                currentDonator++;
                if (currentDonator >= donators.length) currentDonator = 0;

                const newValue = donators[currentDonator]
                var funnyElement = document.getElementById("thanks");

                funnyElement.innerText = ""
            }

            setInterval(updateSocials, 6000);
            setInterval(updateDonators, 3000);
            setInterval(updateClocks, 500);
            updateClocks();
        </script>
        <script>
    function reloadImage() {
        const imgElement = document.querySelector("h1 img");
        const currentSrc = imgElement.src;
        imgElement.src = currentSrc + '?t=' + new Date().getTime(); // Ajoute un timestamp pour √©viter la mise en cache
    }

    setInterval(reloadImage, 60000); // 10 minutes = 600000 ms
</script>

        <!-- Script pour r√©cup√©rer les donn√©es RSS et mettre √† jour les informations -->
      <script>
    const apiUrl = 'https://www.hamqsl.com/solarrss.php';
    const allOriginsUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(apiUrl)}`;

    // Fonction pour r√©cup√©rer et afficher les donn√©es
    function fetchData() {
        fetch(allOriginsUrl)
          .then(response => response.json())
          .then(data => {
            const parser = new DOMParser();
            const xmlData = parser.parseFromString(data.contents, "text/xml");

            // R√©cup√©rer les informations de signal noise et MUF
            const signalNoise = xmlData.querySelector('signalnoise').textContent;
            const muf = xmlData.querySelector('muf').textContent;

            // Mettre √† jour le contenu de desc1 et desc2 avec signalNoise et MUF
            document.getElementById('desc1').innerHTML = `Signal Noise: ${signalNoise}`;
            document.getElementById('desc2').innerHTML = `<id id="muf">MUF:</id> ${muf}`;

            // Mettre √† jour les couleurs en fonction de signalNoise et MUF
            updateColors(signalNoise, muf);

            // R√©cup√©rer les donn√©es pour 80m-40m day et night
            const bandDay = xmlData.querySelector('band[name="80m-40m"][time="day"]').textContent.trim().toLowerCase();
            const bandNight = xmlData.querySelector('band[name="80m-40m"][time="night"]').textContent.trim().toLowerCase();

            // Afficher les valeurs r√©cup√©r√©es dans la console pour diagnostic
            console.log("Valeur de bandDay:", bandDay);
            console.log("Valeur de bandNight:", bandNight);

            // Mettre √† jour le contenu de desc3 pour les donn√©es day et desc4 pour night
            const desc3Element = document.getElementById('desc3');
            const desc4Element = document.getElementById('desc4');

            desc3Element.innerHTML = `<id id="muf">80m Day:</id> ${bandDay}`;
            desc4Element.innerHTML = `<id id="muf">80m Night:</id> ${bandNight}`;

            // Appliquer les couleurs pour les bandes day et night
            applyBandColor(bandDay, desc3Element);
            applyBandColor(bandNight, desc4Element);
          })
          .catch(err => console.error('Erreur lors de la r√©cup√©ration des donn√©es:', err));
    }

    // Appel initial pour r√©cup√©rer les donn√©es au chargement de la page
    fetchData();

    // Recharger les donn√©es toutes les 60 secondes (60000 millisecondes)
    setInterval(fetchData, 60000);

    // Fonction pour mettre √† jour les couleurs en fonction de signalNoise et MUF
    function updateColors(signalNoise, muf) {
        console.log("Valeur de signalNoise : ", signalNoise); // Pour voir la valeur exacte dans la console

        // R√©cup√©rer l'√©l√©ment desc1
        const desc1Element = document.getElementById('desc1');

        // V√©rifier si l'√©l√©ment existe bien
        if (!desc1Element) {
            console.error("L'√©l√©ment avec l'ID 'desc1' n'existe pas.");
            return;
        }

        // Appliquer des couleurs bas√©es sur le signalNoise
        switch (signalNoise.toLowerCase().trim()) {
            case 's1-s2':
                desc1Element.style.color = 'yellow';
                break;
            case 'S2-S3':
                desc1Element.style.color = 'lightorange';
                break;
            case 's3-s4':
                desc1Element.style.color = 'orange';
                break;
            case 's4-s5':
                desc1Element.style.color = 'red';
                break;
            case 's5':
                desc1Element.style.color = 'darkred';
                break;
            default:
                desc1Element.style.color = 'white'; // Couleur par d√©faut
        }

        // M√™me logique pour desc2 (MUF)
        const desc2Element = document.getElementById('desc2');
        if (desc2Element) {
            desc2Element.style.color = (muf === 'NoRpt') ? 'green' : 'orange';
        }
    }

    // Fonction pour appliquer les couleurs aux bandes en fonction des valeurs poor, fair, good
    function applyBandColor(bandValue, element) {
        if (bandValue === 'poor') {
            element.style.color = 'red';
        } else if (bandValue === 'fair') {
            element.style.color = 'yellow';
        } else if (bandValue === 'good') {
            element.style.color = 'green';
        } else {
            element.style.color = 'white'; // Couleur par d√©faut si aucune valeur ne correspond
        }
    }
</script>



        <!-- Script pour la gestion des textes sociaux et des donateurs (inchang√©) -->
        <script>
            setInterval(updateSocials, 6000);
            setInterval(updateDonators, 3000);
        </script>
    </head>
</html>
